<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>连接查询 | SQlite源码分析</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.3.4">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../srcAnaly/README.html" />
    
    
    <link rel="prev" href="../optimalandquery/compress.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book" data-level="5.2.4" data-basepath=".." data-revision="1421037444821">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="READMEGroup10.html">
            
                
                    <a href="../READMEGroup10.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         首页
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="sqlite/srcAnalyG10.html">
            
                
                    <a href="../sqlite/srcAnalyG10.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         sqlite数据库源码分析报告（第十组）
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="sqlite/workshare.html">
            
                
                    <a href="../sqlite/workshare.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         小组成员及分工
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="sqlite/sqlitelimiteh.html">
            
                
                    <a href="../sqlite/sqlitelimiteh.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         SqliteLimite.h 数据库源码分析报告
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.3" data-path="sqlite/sqliteinth.html">
            
                
                    <a href="../sqlite/sqliteinth.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                         SqliteInt.h 数据库源码分析报告
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="README3.html">
            
                
                    <a href="../README3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         数据库源码分析报告
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="README2.html">
            
                
                    <a href="../README2.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         小组成员分工情况
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="sqlite/README.html">
            
                
                    <a href="../sqlite/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         关于SQLite
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="sqlite/sqlite.html">
            
                
                    <a href="../sqlite/sqlite.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         什么是SQLite
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.2" data-path="sqlite/structure.html">
            
                
                    <a href="../sqlite/structure.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                         SQLite的体系结构
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="optimalandquery/readme.html">
            
                
                    <a href="../optimalandquery/readme.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         SQLite的查询及优化
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="5.1" data-path="optimalandquery/query.html">
            
                
                    <a href="../optimalandquery/query.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                         在SQLite3下查询数据
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.2" data-path="optimalandquery/optimalquery.html">
            
                
                    <a href="../optimalandquery/optimalquery.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                         SQLite查询优化
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="5.2.1" data-path="optimalandquery/factor.html">
            
                
                    <a href="../optimalandquery/factor.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.1.</b>
                        
                         影响查询性能的因素
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.2.2" data-path="optimalandquery/transcation.html">
            
                
                    <a href="../optimalandquery/transcation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.2.</b>
                        
                         几个查询优化的转换
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.2.3" data-path="optimalandquery/compress.html">
            
                
                    <a href="../optimalandquery/compress.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.3.</b>
                        
                         子查询扁平化
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="5.2.4" data-path="optimalandquery/link.html">
            
                
                    <a href="../optimalandquery/link.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.4.</b>
                        
                         连接查询
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="srcAnaly/README.html">
            
                
                    <a href="../srcAnaly/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         源码浅析
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="6.1" data-path="srcAnaly/selectExec.html">
            
                
                    <a href="../srcAnaly/selectExec.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                         简单select语句的执行过程
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6.2" data-path="srcAnaly/lowAnaly.html">
            
                
                    <a href="../srcAnaly/lowAnaly.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                         浅析几个函数
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="6.2.1" data-path="srcAnaly/keyFunc.html">
            
                
                    <a href="../srcAnaly/keyFunc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.1.</b>
                        
                         sqlite查询处理的关键函数
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="6.3" data-path="srcAnaly/otherFunc.html">
            
                
                    <a href="../srcAnaly/otherFunc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                         其它一些函数的功能
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="7" data-path="READMEG14.html">
            
                
                    <a href="../READMEG14.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="8" data-path="sqlitereport/README.html">
            
                
                    <a href="../sqlitereport/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                         SQLite源码分析报告
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="8.1" data-path="sqlitereport/group.html">
            
                
                    <a href="../sqlitereport/group.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                         小组成员及分工
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="9" data-path="sqlite/READMEG14.html">
            
                
                    <a href="../sqlite/READMEG14.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                         SQLite的介绍
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="10" data-path="sqliteplacefile_name_should_be_unique.html">
            
                
                    <a href="../sqliteplacefile_name_should_be_unique.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                         分析源代码在SQLite中的地位
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11" data-path="authc/README.html">
            
                
                    <a href="../authc/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                         访问授权函数（auth.c的源码分析）
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="11.1" data-path="authc/set.html">
            
                
                    <a href="../authc/set.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.1.</b>
                        
                         设置或清除访问授权
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11.2" data-path="authc/authbadreturncode.html">
            
                
                    <a href="../authc/authbadreturncode.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.2.</b>
                        
                         授权返回一个非法的值
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11.3" data-path="authc/authreadcol.html">
            
                
                    <a href="../authc/authreadcol.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.3.</b>
                        
                         验证数据库中表的列信息是否可访问
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11.4" data-path="authc/tk_column.html">
            
                
                    <a href="../authc/tk_column.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.4.</b>
                        
                         验证解析树中TK_COLUMN表达式是否可访问
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11.5" data-path="authc/authcheck.html">
            
                
                    <a href="../authc/authcheck.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.5.</b>
                        
                         使用给定的代码和参数的授权检查
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11.6" data-path="authc/authcontext.html">
            
                
                    <a href="../authc/authcontext.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.6.</b>
                        
                         利用栈存储解析树的授权内容
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="12" data-path="alter_tablealterc/README.html">
            
                
                    <a href="../alter_tablealterc/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                         实现修改表功能ALTER TABLE（alter.c的源码分析）
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="12.1" data-path="alter_tablealterc/renametablefunc.html">
            
                
                    <a href="../alter_tablealterc/renametablefunc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.1.</b>
                        
                         重命名表的名称
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12.2" data-path="alter_tablealterc/renameparentfunc.html">
            
                
                    <a href="../alter_tablealterc/renameparentfunc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.2.</b>
                        
                         修改任何外键约束定义重命名表为父表
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12.3" data-path="alter_tablealterc/renametriggerfunc.html">
            
                
                    <a href="../alter_tablealterc/renametriggerfunc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.3.</b>
                        
                         对触发器的表名做修改
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12.4" data-path="alter_tablealterc/whereorname.html">
            
                
                    <a href="../alter_tablealterc/whereorname.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.4.</b>
                        
                         创建表达式形式的文本
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12.5" data-path="alter_tablealterc/whereforeignkeys.html">
            
                
                    <a href="../alter_tablealterc/whereforeignkeys.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.5.</b>
                        
                         生成用来选择有外键约束的全部表的表达式文本
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12.6" data-path="alter_tablealterc/ptab.html">
            
                
                    <a href="../alter_tablealterc/ptab.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.6.</b>
                        
                         删除和重新加载从数据库表pTab的内部模式
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12.7" data-path="alter_tablealterc/issystemtable.html">
            
                
                    <a href="../alter_tablealterc/issystemtable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.7.</b>
                        
                         判断一个系统表
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12.8" data-path="alter_tablealterc/alterrenametable.html">
            
                
                    <a href="../alter_tablealterc/alterrenametable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.8.</b>
                        
                         删除表名并重命名为新表名
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="13" data-path="analyzeanalyzec/README.html">
            
                
                    <a href="../analyzeanalyzec/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                         ANALYZE命令的处理（analyze.c文件源码解析）
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="13.1" data-path="analyzeanalyzec/analyzesql.html">
            
                
                    <a href="../analyzeanalyzec/analyzesql.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.1.</b>
                        
                         Analyze的SQL语法
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13.2" data-path="analyzeanalyzec/analyze.html">
            
                
                    <a href="../analyzeanalyzec/analyze.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.2.</b>
                        
                         Analyze 命令接口
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13.3" data-path="analyzeanalyzec/analyzedatabase.html">
            
                
                    <a href="../analyzeanalyzec/analyzedatabase.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.3.</b>
                        
                         analyzeDatabase函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13.4" data-path="analyzeanalyzec/analyzetable.html">
            
                
                    <a href="../analyzeanalyzec/analyzetable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.4.</b>
                        
                         analyzeTable函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13.5" data-path="analyzeanalyzec/loadanalysis.html">
            
                
                    <a href="../analyzeanalyzec/loadanalysis.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.5.</b>
                        
                         loadAnalysis函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13.6" data-path="analyzeanalyzec/analyzeonetable.html">
            
                
                    <a href="../analyzeanalyzec/analyzeonetable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.6.</b>
                        
                         analyzeOneTable函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13.7" data-path="analyzeanalyzec/stat3initstat3pushstat3get.html">
            
                
                    <a href="../analyzeanalyzec/stat3initstat3pushstat3get.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.7.</b>
                        
                         stat3Init函数，stat3Push函数，stat3Get函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13.8" data-path="analyzeanalyzec/other.html">
            
                
                    <a href="../analyzeanalyzec/other.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.8.</b>
                        
                         其他用到的一些函数
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="14" data-path="sqlfuncc/README.html">
            
                
                    <a href="../sqlfuncc/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                         实现SQL的各种函数(func.c的源码分析)
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="14.1" data-path="sqlfuncc/jisuan.html">
            
                
                    <a href="../sqlfuncc/jisuan.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.1.</b>
                        
                         算术函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="14.2" data-path="sqlfuncc/zifu.html">
            
                
                    <a href="../sqlfuncc/zifu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.2.</b>
                        
                         字符处理函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="14.3" data-path="sqlfuncc/tiaojian.html">
            
                
                    <a href="../sqlfuncc/tiaojian.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.3.</b>
                        
                         条件判断函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="14.4" data-path="sqlfuncc/jihe.html">
            
                
                    <a href="../sqlfuncc/jihe.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.4.</b>
                        
                         集合函数
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="14.5" data-path="sqlfuncc/qita.html">
            
                
                    <a href="../sqlfuncc/qita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.5.</b>
                        
                         其他函数
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="15" data-path="file_name_should_be_unique.html">
            
                
                    <a href="../file_name_should_be_unique.html">
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                         总结
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="16" data-path="conclusion.html">
            
                
                    <a href="../conclusion.html">
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                         总结
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="17" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                         首页
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="18" data-path="gs.html">
            
                
                    <a href="../gs.html">
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                         概述
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="19" data-path="rtree/README.html">
            
                
                    <a href="../rtree/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                         编译Rtree模块
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="20" data-path="rtree/usertree.html">
            
                
                    <a href="../rtree/usertree.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                         使用Rtree模块
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="20.1" data-path="rtree/createRtree.html">
            
                
                    <a href="../rtree/createRtree.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.1.</b>
                        
                         创建一个Rtree索引
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="20.2" data-path="rtree/getRtree.html">
            
                
                    <a href="../rtree/getRtree.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.2.</b>
                        
                         获取一个Rtree索引
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="20.3" data-path="rtree/queryRtree.html">
            
                
                    <a href="../rtree/queryRtree.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.3.</b>
                        
                         查询一个Rtree索引
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="20.4" data-path="rtree/round.html">
            
                
                    <a href="../rtree/round.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.4.</b>
                        
                         舍入偏差
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="21" data-path="rtree/efficientuse.html">
            
                
                    <a href="../rtree/efficientuse.html">
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                         有效使用Rtree
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="22" data-path="r/README.html">
            
                
                    <a href="../r/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                         整型R树
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="23" data-path="r/tailorrtree.html">
            
                
                    <a href="../r/tailorrtree.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                         定制R树查询
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="23.1" data-path="r/xgeom.html">
            
                
                    <a href="../r/xgeom.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.1.</b>
                        
                         旧版本xGeom回调
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="23.2" data-path="r/xqueryfunc.html">
            
                
                    <a href="../r/xqueryfunc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.2.</b>
                        
                         全新xQueryFunc回调
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="23.3" data-path="r/tailor.html">
            
                
                    <a href="../r/tailor.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.3.</b>
                        
                         定制查询注意事项
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="24" data-path="sqliter/README.html">
            
                
                    <a href="../sqliter/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                         SQLiteR树结构
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="24.1" data-path="sqliter/NodeStruct.html">
            
                
                    <a href="../sqliter/NodeStruct.html">
                        <i class="fa fa-check"></i>
                        
                            <b>24.1.</b>
                        
                         结点结构
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="24.2" data-path="sqliter/CellStruct.html">
            
                
                    <a href="../sqliter/CellStruct.html">
                        <i class="fa fa-check"></i>
                        
                            <b>24.2.</b>
                        
                         结点单元结构
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="25" data-path="rr/README.html">
            
                
                    <a href="../rr/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                         R树特点及算法实现
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="25.1" data-path="rr/Searing.html">
            
                
                    <a href="../rr/Searing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.1.</b>
                        
                         查找
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="25.2" data-path="rr/Insertion.html">
            
                
                    <a href="../rr/Insertion.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.2.</b>
                        
                         插入
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="25.3" data-path="rr/Deletion.html">
            
                
                    <a href="../rr/Deletion.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.3.</b>
                        
                         删除
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="25.4" data-path="rr/Update.html">
            
                
                    <a href="../rr/Update.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.4.</b>
                        
                         更新
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="25.5" data-path="rr/QSplit.html">
            
                
                    <a href="../rr/QSplit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.5.</b>
                        
                         平方分裂
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="25.6" data-path="rr/LinearSplit.html">
            
                
                    <a href="../rr/LinearSplit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.6.</b>
                        
                         线性分裂
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="26" data-path="rstar/README.html">
            
                
                    <a href="../rstar/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                         R*树优化
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="26.1" data-path="rstar/local.html">
            
                
                    <a href="../rstar/local.html">
                        <i class="fa fa-check"></i>
                        
                            <b>26.1.</b>
                        
                         局部优化
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="26.2" data-path="rstar/all.html">
            
                
                    <a href="../rstar/all.html">
                        <i class="fa fa-check"></i>
                        
                            <b>26.2.</b>
                        
                         整体优化
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="27" data-path="READMEG18.html">
            
                
                    <a href="../READMEG18.html">
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                         Group 18
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="28" data-path="introduce/introduce.html">
            
                
                    <a href="../introduce/introduce.html">
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                         SQLite 源码分析报告
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="29" data-path="first/zaiyao.html">
            
                
                    <a href="../first/zaiyao.html">
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                         摘要
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="30" data-path="second/jianjie.html">
            
                
                    <a href="../second/jianjie.html">
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                         SQLite简介
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="31" data-path="third/fenxi.html">
            
                
                    <a href="../third/fenxi.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                         源码分析
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="31.1" data-path="third/txjg.html">
            
                
                    <a href="../third/txjg.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.1.</b>
                        
                         SQLite体系结构
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="31.2" data-path="third/xjklc.html">
            
                
                    <a href="../third/xjklc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.2.</b>
                        
                         简析打开数据库流程
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="31.3" data-path="third/hsjg.html">
            
                
                    <a href="../third/hsjg.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.3.</b>
                        
                         简析os_win.c文件的函数结构
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="31.4" data-path="third/sjz.html">
            
                
                    <a href="../third/sjz.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.4.</b>
                        
                         简析SQLite的锁机制
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="31.5" data-path="third/sxlc.html">
            
                
                    <a href="../third/sxlc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.5.</b>
                        
                         SQLite在Windows系统上的锁机制实现流程
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="31.6" data-path="third/sxym.html">
            
                
                    <a href="../third/sxym.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.6.</b>
                        
                         锁机制在Windows中的实现源码
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >SQlite源码分析</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_137">
                    
                        <h1 id="">连接查询</h1>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在返回查询结果之前，相关表的每行必须都已经连接起来，在SQLite中，这是用嵌套循环实现的，在早期版本中，最左边的是最外层循环，最右边的是最内层循环，连接两个或者更多的表时，如果有索引则放到内层循环中，也就是放到FROM最后面，因为对于前面选中的每行，找后面与之对应的行时，如果有索引则会很快，如果没有则要遍历整个表，这样效率就很低，但在新版本中，这个优化已经实现。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;优化的方法如下：<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对要查询的每个表，统计这个表上的索引信息，首先将代价赋值为SQLITE_BIG_DBL（一个系统已经定义的常量）：<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>1)如果没有索引，则找有没有在这个表上对rowid的查询条件。</strong><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1．如果有Rowid=EXPR，如果有的话则返回对这个表代价估计，代价计为零，查询得到的记录数为1，并完成对这个表的代价估计。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2．如果没有Rowid=EXPR 但有rowid IN  (...)，而IN是一个列表，那么记录返回记录数为IN列表中元素的个数，估计代价为NlogN。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3．如果IN不是一个列表而是一个子查询结果，那么由于具体这个子查询不能确定，所以只能估计一个值，返回记录数为100，代价为200。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4．如果对rowid是范围的查询，那么就估计所有符合条件的记录是总记录的三分之一，总记录估计为1000000，并且估计代价也为记录数。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5．如果这个查询还要求排序，则再另外加上排序的代价NlogN。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6．如果此时得到的代价小于总代价，那么就更新总代价，否则不更新。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>2)如果WHERE子句中存在OR操作符，那么要把这些OR连接的所有子句分开再进行分析。</strong><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1．如果有子句是由AND连接符构成，那么再把由AND连接的子句再分别分析。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2．如果连接的子句的形式是X<op><expr>，那么就再分析这个子句。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3． 接下来就是把整个对OR操作的总代价计算出来。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4．如果这个查询要求排序，则再在上面总代价上再乘上排序代价NlogN。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5．如果此时得到的代价小于总代价，那么就更新总代价，否则不更新。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>3) 如果有索引，则统计每个表的索引信息，对于每个索引。</strong><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1．先找到这个索引对应的列号，再找到对应的能用到（操作符必须为=或者是IN（…））这个索引的WHERE子句，如果没有找到，则退出对每个索引的循环，如果找到，则判断这个子句的操作符是什么，如果是=，那么没有附加的代价，如果是IN（sub-select），那么估计它附加代价inMultiplier为25，如果是IN（list），那么附加代价就是N（N为list的列数）。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2． 再计算总的代价和总的查询结果记录数和代价。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3． nRow = pProbe-&gt;aiRowEst[i] <em> inMultiplier;/</em>计算行数<em>/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4． cost = nRow </em> estLog(inMultiplier);/<em>统计代价</em>/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5．如果找不到操作符为=或者是IN（…）的子句，而是范围的查询，那么同样只好估计查询结果记录数为nRow/3，估计代价为cost/3。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6．同样，如果此查询要求排序的话，再在上面的总代价上加上NlogN。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7．如果此时得到的代价小于总代价，那么就更新总代价，否则不更新。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>4)通过上面的优化过程，可以得到对一个表查询的总代价（就是上面各个代价的总和），再对第二个表进行同样的操作，这样如此直到把FROM子句中所有的表都计算出各自的代价，最后取最小的，这将作为嵌套循环的最内层，依次可以得到整个嵌套循环的嵌套顺序，此时正是最优的，达到了优化的目的。</strong></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../optimalandquery/compress.html" class="navigation navigation-prev " aria-label="Previous page: 子查询扁平化"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../srcAnaly/README.html" class="navigation navigation-next " aria-label="Next page: 源码浅析"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
